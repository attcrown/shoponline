<template>
    <div>
        <div :class="!deviceMode ? 'center-container' : ''" 
            :style="!deviceMode ? 'height: 89vh;' : 'height: 100%;'" 
            style="background: linear-gradient(to right, #0381f7ad, #78baf094,#78baf094, #0577fa9a);">
            <div class="container fontsMoi text-center " rounded="xxl"
                style="background-color:transparent; max-width: 500px;">
                <div class="d-flex justify-center">
                    <v-img :src="require('@/assets/logoexchange.png')" style="opacity: 0.8" max-width="300px"></v-img>
                </div>                
                <h1 class="fw-bold">Exchange Shop <span class="mdi mdi-shopping-outline text-h4"></span></h1>
                <hr style="border-bottom: 2px solid #000">
                <p class="text--secondary font-weight-black fontsPro">
                    <br>‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡πá‡πÄ‡∏ó‡∏£‡∏î‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß <br><br>
                    üëá‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâüëá
                </p>                
                <v-btn
                    @click="$router.push('/CenterShop/shop')"
                    color="success"
                    dark
                    class="fontsPro"
                    rounded
                    elevation="16">      
                    <div class="ms-3 d-flex justify-center">            
                        ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ 
                        <v-icon color="#FAFAFA">
                            mdi-chevron-right
                        </v-icon> 
                    </div>                                      
                </v-btn>                
            </div>
            <v-card elevation="5" :class="!deviceMode ? 'container rounded-xxl' : 'container'" max-width="500px"
                style="background-color: rgba(255, 255, 255, 0.401);">
                <h1 class="text-center fontsPro">LOGIN</h1>
                <v-form ref="form" v-model="valid" lazy-validation>

                    <v-text-field
                        v-model="register.email" 
                        :rules="emailRules" 
                        prepend-icon="mdi mdi-email-outline"
                        required></v-text-field>

                    <v-text-field 
                        v-model="register.password" 
                        :rules="passRules" 
                        type="password" 
                        prepend-icon="mdi mdi-lock"
                        required></v-text-field>

                    <div class="text-center fontsPro">
                        <v-btn :disabled="!valid" color="success" rounded @click="validate">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                            <v-icon right dark>
                                mdi-login
                            </v-icon>
                        </v-btn>
                    </div>
                </v-form>
                <v-card-text class="fontsPro">
                    <a href="#" @click="sendSignin(true)">‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</a><br><br>
                    <a href="/CenterShop/resetpass">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</a>
                </v-card-text>
            </v-card>
        </div>
        <v-card v-if="!deviceMode">
            <p class="text-center fontsPro pt-1">
                English (UK) ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ Êó•Êú¨Ë™û ‰∏≠Êñá(ÁÆÄ‰Ωì) Ti·∫øng Vi·ªát Fran√ßais (France) Deutsch –†—É—Å—Å–∫–∏–π Espa√±ol Portugu√™s (Brasil) <br>
                ‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏ö‡∏ö Real-time ‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô <br>
                Ensuring real-time, cutting-edge security throughout every usage phase. <br>
                ¬© 2024
            </p>
        </v-card>
        <signin></signin>
        <AlertButtom ref="AlertButtom"></AlertButtom>
    </div>
</template>
<script>
import AlertButtom from '~/components/AlertButtom.vue';
import signin from './signin.vue';
import { sendSignin } from './signin.vue';
export default {
    layout: 'login',
    data: () => ({
        valid: true,
        deviceMode: true,
        register: [],
        passRules: [
            v => !!v || 'Password is required'
        ],
        emailRules: [
            v => !!v || 'E-mail is required',
            v => /.+@.+\..+/.test(v) || 'E-mail must be valid',
        ],

    }),

    components: {
        AlertButtom,
        signin
    },

    mounted() {
        this.checkMobile();
        window.addEventListener('resize', this.checkMobile);
    },

    methods: {
        checkMobile() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ isMobile
            this.deviceMode = window.innerWidth <= 768; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô mobile ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 768 pixels
        },
        validate() {
            if (this.$refs.form.validate()) {
                this.login(this.register);
            }
        },
        reset() {
            this.$refs.form.reset()
        },
        resetValidation() {
            this.$refs.form.resetValidation()
        },

        login(item) {
            const auth = this.$fireModule.auth();
            auth.signInWithEmailAndPassword(item.email, item.password) // ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ "PASSWORD" ‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ
                .then((userCredential) => {
                    // ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    const user = userCredential.user;
                    console.log("User logged in successfully:");
                    if (!user.emailVerified) {
                        //snackbar
                        this.$refs.AlertButtom.snackbar = true;
                        this.$refs.AlertButtom.colorAlart = 'red';
                        this.$refs.AlertButtom.text = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•';
                    }else{
                        this.$store.commit('SET_USER', user);
                        this.$router.push('/CenterShop/shop');
                    }                    
                })
                .catch((error) => {
                    // ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    console.error("Login failed:", errorCode, errorMessage);

                    //snackbar
                    this.$refs.AlertButtom.snackbar = true;
                    this.$refs.AlertButtom.colorAlart = 'red';
                    this.$refs.AlertButtom.text = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ';
                });
        },
        sendSignin(item){
            sendSignin.$emit('ShowSign', item, (callback) => {
                console.log(callback);
            })
        }
    }
}
</script>

<style>
.center-container {
    display: flex;
    justify-content: center;
    align-items: center;
    /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
}


.fontsMoi {
    font-family: 'Moirai One', sans-serif;
    font-weight: 400;
}

.fontsPro {
    font-family: 'Prompt', sans-serif;
    font-weight: 800;
}

.fontsDanc {
    font-family: 'Dancing Script', sans-serif;
    font-weight: 500;
}
</style>
